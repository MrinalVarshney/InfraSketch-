{
  "connected_services": [
    {
      "name": "test",
      "services": [
        {
          "id": "kubernetes-kubernetes-1",
          "provider": "kubernetes",
          "metadata": {
            "name": "mongo-deployment",
            "labels": {
              "app": "mongodb"
            }
          },
          "spec": {
            "replicas": 2,
            "selector": {
              "matchLabels": {
                "app": "mongodb"
              }
            },
            "template": {
              "metadata": {
                "labels": {
                  "app": "mongodb"
                }
              },
              "spec": {
                "containers": [
                  {
                    "name": "mongodb",
                    "image": "mongo:latest",
                    "env": [
                      {
                        "name": "MONGO_INITDB_ROOT_USERNAME",
                        "valueFrom": {
                          "secretKeyRef": {
                            "name": "db-credentials",
                            "key": "username"
                          }
                        }
                      },
                      {
                        "name": "MONGO_INITDB_ROOT_PASSWORD",
                        "valueFrom": {
                          "secretKeyRef": {
                            "name": "db-credentials",
                            "key": "password"
                          }
                        }
                      }
                    ],
                    "ports": [
                      {
                        "containerPort": 27017
                      }
                    ]
                  }
                ]
              }
            }
          },
          "type": "deployment"
        },
        {
          "id": "kubernetes-network-2",
          "provider": "kubernetes",
          "type": "service",
          "metadata": {
            "name": "mongo-service",
            "labels": {},
            "annotations": {}
          },
          "spec": {
            "type": "ClusterIP",
            "selector": {
              "app": "mongodb"
            },
            "ports": [
              {
                "port": 27017,
                "name": "http",
                "targetPort": 27017
              }
            ],
            "clusterIP": "",
            "externalIPs": []
          }
        },
        {
          "id": "kubernetes-secret-3",
          "provider": "kubernetes",
          "metadata": {
            "name": "db-credentials",
            "labels": {
              "app": "my-db"
            },
            "annotations": {}
          },
          "secret_type": "Opaque",
          "data": {
            "username": "dXNlcm5hbWU=",
            "password": "cGFzc3dvcmQ="
          },
          "spec": {
            "selector": {
              "app": "mongo-express"
            }
          },
          "type": "secret"
        },
        {
          "id": "kubernetes-kubernetes-4",
          "provider": "kubernetes",
          "metadata": {
            "name": "mongo-express-deployment",
            "labels": {
              "app": "mongo-express"
            }
          },
          "spec": {
            "replicas": 2,
            "selector": {
              "matchLabels": {
                "app": "mongo-express"
              }
            },
            "template": {
              "metadata": {
                "labels": {
                  "app": "mongo-express"
                }
              },
              "spec": {
                "containers": [
                  {
                    "name": "mongo-express",
                    "image": "mongo-express",
                    "env": [
                      {
                        "name": "ME_CONFIG_MONGODB_ADMINUSERNAME",
                        "valueFrom": {
                          "secretKeyRef": {
                            "name": "db-credentials",
                            "key": "username"
                          }
                        }
                      },
                      {
                        "name": "ME_CONFIG_MONGODB_ADMINPASSWORD",
                        "valueFrom": {
                          "secretKeyRef": {
                            "name": "db-credentials",
                            "key": "password"
                          }
                        }
                      },
                      {
                        "name": "ME_CONFIG_MONGODB_SERVER",
                        "valueFrom": {
                          "configMapKeyRef": {
                            "name": "mongo-express-config",
                            "key": "db_url"
                          }
                        }
                      },
                      {
                        "name": "ME_CONFIG_MONGODB_URL",
                        "valueFrom": {
                          "configMapKeyRef": {
                            "name": "mongo-express-config",
                            "key": "db_url"
                          }
                        }
                      }
                    ],
                    "ports": [
                      {
                        "containerPort": 8081
                      }
                    ]
                  }
                ]
              }
            }
          },
          "type": "deployment"
        },
        {
          "id": "kubernetes-network-5",
          "provider": "kubernetes",
          "type": "service",
          "metadata": {
            "name": "mongo-express",
            "labels": {},
            "annotations": {}
          },
          "spec": {
            "type": "ClusterIP",
            "selector": {
              "app": "mongo-express"
            },
            "ports": [
              {
                "port": 8081,
                "name": "http",
                "targetPort": 8081
              }
            ],
            "clusterIP": "",
            "externalIPs": []
          }
        },
        {
          "id": "kubernetes-storage-6",
          "provider": "kubernetes",
          "metadata": {
            "name": "mongo-express-config",
            "labels": {
              "app": "mongo-express"
            },
            "annotations": {}
          },
          "data": {
            "db_url": "mongo-service"
          },
          "spec": {
            "selector": {
              "app": "mongo-express"
            }
          },
          "type": "config_map"
        },
        {
          "id": "",
          "provider": "kubernetes",
          "type": "ingress",
          "metadata": {
            "name": "my-ingress",
            "annotations": {
              "kubernetes": {
                "io/ingress": {
                  "class": "nginx"
                }
              },
              "nginx": {
                "ingress": {
                  "kubernetes": {
                    "io/rewrite-target": "/"
                  }
                }
              }
            }
          },
          "spec": {
            "rules": [
              {
                "http": {
                  "paths": [
                    {
                      "path": "/",
                      "pathType": "Prefix",
                      "backend": {
                        "service": {
                          "name": "mongo-express",
                          "port": 8081
                        }
                      }
                    }
                  ]
                },
                "host": "mongo.com"
              },
              {
                "http": {
                  "paths": [
                    {
                      "path": "/",
                      "pathType": "Prefix",
                      "backend": {
                        "service": {
                          "name": "wordpress-service",
                          "port": 80
                        }
                      }
                    }
                  ]
                },
                "host": "wordpress.com"
              }
            ],
            "tls": []
          }
        },
        {
          "id": "kubernetes-kubernetes-8",
          "provider": "kubernetes",
          "metadata": {
            "name": "wordpress-deployement",
            "labels": {
              "app": "wordpress"
            }
          },
          "spec": {
            "replicas": 1,
            "selector": {
              "matchLabels": {
                "app": "wordpress"
              }
            },
            "template": {
              "metadata": {
                "labels": {
                  "app": "wordpress"
                }
              },
              "spec": {
                "containers": [
                  {
                    "name": "wordpress",
                    "image": "wordpress:latest",
                    "env": [
                      {
                        "name": "WORDPRESS_DB_HOST",
                        "value": "mysql:3306"
                      },
                      {
                        "name": "WORDPRESS_DB_PASSWORD",
                        "valueFrom": {
                          "secretKeyRef": {
                            "name": "secret-safe",
                            "key": "password"
                          }
                        }
                      }
                    ],
                    "ports": [
                      {
                        "containerPort": 80
                      }
                    ]
                  }
                ]
              }
            }
          },
          "type": "deployment"
        },
        {
          "id": "kubernetes-secret-9",
          "provider": "kubernetes",
          "metadata": {
            "name": "secret-safe",
            "labels": {
              "app": "secrets"
            },
            "annotations": {}
          },
          "secret_type": "Opaque",
          "data": {
            "password": "cGFzc3dvcmQ="
          },
          "spec": {
            "selector": {
              "app": "mysql"
            }
          },
          "type": "secret"
        },
        {
          "id": "kubernetes-network-10",
          "provider": "kubernetes",
          "type": "service",
          "metadata": {
            "name": "wordpress-service",
            "labels": {},
            "annotations": {}
          },
          "spec": {
            "type": "ClusterIP",
            "selector": {
              "app": "wordpress"
            },
            "ports": [
              {
                "port": 80,
                "name": "http",
                "targetPort": 80
              }
            ],
            "clusterIP": "",
            "externalIPs": []
          }
        },
        {
          "id": "",
          "provider": "kubernetes",
          "type": "persistent_volume",
          "metadata": {
            "name": "my-pv"
          },
          "spec": {
            "capacity": {
              "storage": "5Gi"
            },
            "accessModes": "ReadWriteOnce",
            "type": "local",
            "hostPath": {
              "path": "/data/sql"
            },
            "storageClassName": "manual"
          }
        },
        {
          "id": "",
          "provider": "kubernetes",
          "type": "persistent_volume_claim",
          "metadata": {
            "name": "my-pvc-claim",
            "namespace": "default"
          },
          "spec": {
            "accessModes": "ReadWriteOnce",
            "resources": {
              "requests": {
                "storage": "5Gi"
              }
            },
            "storageClassName": "manual"
          }
        },
        {
          "id": "kubernetes-kubernetes-13",
          "provider": "kubernetes",
          "metadata": {
            "name": "mysql-deployment",
            "labels": {
              "app": "mysql"
            }
          },
          "spec": {
            "replicas": 2,
            "selector": {
              "matchLabels": {
                "app": "mysql"
              }
            },
            "template": {
              "metadata": {
                "labels": {
                  "app": "mysql"
                }
              },
              "spec": {
                "containers": [
                  {
                    "name": "mysql",
                    "image": "mysql:5.7",
                    "env": [
                      {
                        "name": "MYSQL_ROOT_PASSWORD",
                        "valueFrom": {
                          "secretKeyRef": {
                            "name": "secret-safe",
                            "key": "password"
                          }
                        }
                      }
                    ],
                    "ports": [
                      {
                        "containerPort": 3306
                      }
                    ],
                    "volumeMounts": [
                      {
                        "name": "sql-stora",
                        "mountPath": "/var/lib/mysql"
                      }
                    ]
                  }
                ],
                "volumes": [
                  {
                    "name": "sql-stora",
                    "persistentVolumeClaim": {
                      "claimName": "my-pvc-claim"
                    }
                  }
                ]
              }
            }
          },
          "type": "deployment"
        },
        {
          "id": "kubernetes-network-14",
          "provider": "kubernetes",
          "type": "service",
          "metadata": {
            "name": "mysql-service",
            "labels": {},
            "annotations": {}
          },
          "spec": {
            "type": "ClusterIP",
            "selector": {
              "app": "mysql"
            },
            "ports": [
              {
                "port": 3306,
                "name": "http",
                "targetPort": 3306
              }
            ],
            "clusterIP": "",
            "externalIPs": []
          }
        }
      ]
    }
  ]
}
